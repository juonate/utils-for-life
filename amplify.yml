version: 1
frontend:
  appRoot: frontend
  phases:
    preBuild:
      commands:
        # Se indica al entorno que use Node.js 20, que es requerido por Angular 20.
        - nvm use 20
        # Se usa npm ci para una instalación limpia y rápida desde el lockfile.
        # Como appRoot está definido, este comando se ejecuta dentro de /frontend.
        - npm ci
    build:
      commands:
        # Este comando también se ejecuta dentro de /frontend.
        # npx --package instala temporalmente el CLI, lo usa para compilar y luego lo elimina.
        # Es el método más robusto para evitar errores de EBADENGINE y de 'comando no encontrado'.
        - npx --package @angular/cli@latest ng build
  artifacts:
    # La ruta es ahora relativa al 'appRoot'.
    baseDirectory: dist/utils-app
    files:
      - '**/*'
  cache:
    # La ruta es ahora relativa al 'appRoot'.
    paths:
      - node_modules/**/*